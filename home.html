<!DOCTYPE html>
<!-- Some code used from http://bl.ocks.org/nelliemckesson/5315143 -->
<htm lang="en">
<head>
  <meta charset=utf-8 />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script charset="utf-8" type="text/javascript" src="http://d3js.org/d3.v4.min.js"></script>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <title>Flying Friendly</title>
</head>

<body>
    <h1><img src="logo.png"></h1>

  <div id="container"> <!--d3 chart gets inserted in this div-->
    <image id="plane" src="theplane.png" height="700" width="500">
  </div>
  <p style="margin-top: 10px;
        margin-bottom: 10px;
        margin-left: 10px;
        margin-right: 10px;">
    <button type="button" id="switchSeats" class="button" style="left:380px;top:300px;">
      <img src="SwitchSeatsIconSmall.jpg" class="image"/>
    </button>
    <button type="button" id="windowShade" class="button" style="left:480px;top:300px;">
      <img src="WindowIconSmall.jpg" class="image"/>
    </button>
    <button type="button" id="recliningSeat" class="button" style="left:580px;top:300px">
      <img src="ReclineIconSmall.jpg" class="image" />
    </button>
    <button type="button" id="switchFriends" class="button" style="left:680px;top:300px">
      <!-- Insert switching with a friend image here. Similar to previous -->
    </button>
    <button type="button" id="emptySeat" class="button" style="left:380px;top:200px">
      <!-- Insert moving to an empty seat image here. Similar to previous -->
    </button>
    <button type="button" id="badChildren" class="button" style="left:480px;top:200px">
      <!-- Insert bad children image here. Similar to previous -->
    </button>
    <button type="button" id="wakeBathroom" class="button" style="left:580px;top:200px">
    <!-- Insert waking someone up to go to bathroom image here. Similar to previous -->
    </button>
    <button type="button" id="middleArmrest" class="button" style="left:680px;top:200px">
      <!-- Insert sharing middle armrest image here. Similar to previous -->
    </button>
  </p>
  <script>
  // based on this tutorial: http://mbostock.github.com/d3/tutorial/bar-1.html
  // with adjustments and stuff
  // see it here: http://jsbin.com/avemek/2/ 
  d3.csv("flying-etiquette_v3.csv", function(error, data) {
    var state = 0; // default state for now
    var flag = false;
    if (error) throw error;
    var currentValue = 0;
    var numParticipants = 0;
    var length = data.length;
    data = data.map(function(d) {
      return {
        middleArmrest: d.middleArmrest, // who gets the middle of the two arm rests?
        windowShade:   d.windowShade, // who has control of the window shade
        moveEmpty:     d.moveEmpty, // move to an empty seat
        recliningSeat: d.recliningSeat, // reclining your chair
        switchFriends: d.switchFriends, // switching with a friend
        switchFamily:  d.switchFamily, // switching with a family member
        wakeBathroom:  d.wakeBathroom, // wake someone to use the bathroom
        badChildren:   d.badChildren // having unruly children
      };
    });

  
  // Reclining seat button
  $("#recliningSeat").bind("click", function() {
    flag = true;
    switchState(data, 1);
  });

  // Switching with a friend button  
  $("#switchFriends").bind("click", function() {
    flag = true;
    switchState(data, 2);
  });

  // Switching with a family member button
  $("#switchSeats").bind("click", function() {
    flag = true;
    switchState(data, 3);
  });

  // Window shade control button
  $("#windowShade").bind("click", function() {
    flag = true;
    switchState(data, 4);
  });

  // Mooving to an empty seat button
  $("#emptySeat").bind("click", function() {
    flag = true;
    switchState(data, 5);
  });

  // Having nruly children button  
  $("#badChildren").bind("click", function() {
    flag = true;
    switchState(data, 6);
  });

  // Wake up to use bathroom button
  $("#wakeBathroom").bind("click", function() {
    flag = true;
    switchState(data, 7);
  });

  // Who gets the two arm rests?
  $("#middleArmrest").bind("click", function() {
    flag = true;
    switchState(data, 8);
  });

  function switchState(data, state) {
    currentValue = 0;
    numParticipants = 0;
    if (flag) {
      if (state == 1) {
        for (var i = 0; i < length; i++) {
          if (data[i].recliningSeat.indexOf("Yes,") == 0) {
            currentValue ++;
            numParticipants++;
          } else if (data[i].recliningSeat.indexOf("No,") == 0) {
            numParticipants++;
          }
        }
      } else if (state == 2) {
        for (var i = 0; i < length; i++) {
          if (data[i].switchFriends.indexOf("Yes,") == 0) {
            currentValue++;
            numParticipants++;
          } else if (data[i].switchFriends.indexOf("No,") == 0) {
            numParticipants++;
          }
        }
      } else if (state == 3) {
        for (var i = 0; i < length; i++) {
          if (data[i].switchFamily.indexOf("Yes,") == 0) {
            currentValue++;
            numParticipants++;
          } else if (data[i].switchFriends.indexOf("No,") == 0) {
            numParticipants++;
          }
        }
      } else if (state == 4) {
        for (var i = 0; i < length; i++) {
          if (data[i].windowShade.indexOf("The") == 0) {
            currentValue++;
            numParticipants++;
          } else if (data[i].windowShade.indexOf("Everyone") == 0) {
            numParticipants++;
          }
        }
      } else if (state == 5) {
        for (var i = 0; i < length; i++) {
          if (data[i].moveEmpty.indexOf("Yes,") == 0) {
            currentValue++;
            numParticipants++;
          } else if (data[i].moveEmpty.indexOf("No,") == 0) {
            numParticipants++;
          }
        }
      } else if (state == 6) {
        for (var i = 0; i < length; i++) {
          if (data[i].badChildren.indexOf("Yes,") == 0) {
            currentValue++;
            numParticipants++;
          } else if (data[i].badChildren.indexOf("No,") == 0) {
            numParticipants++;
          }
        }
      } else if (state == 7) {
        for (var i = 0; i < length; i++) {
          if (data[i].wakeBathroom.indexOf("Yes,") == 0) {
            currentValue++;
            numParticipants++;
          } else if (data[i].wakeBathroom.indexOf("No,") == 0) {
            numParticipants++;
          }
        }
      } else if (state == 8) {
        for (var i = 0; i < length; i++) {
          if (data[i].middleArmrest.indexOf("Whoever") == 0) { 
            // whoever puts their arm on it first
            currentValue++;
            numParticipants++;
          } else if (data[i].middleArmrest.indexOf("The") == 0) {
            // the arm rests should be shared or the person in the isle
            numParticipants++;
          }
        }
      } else {
        wait();
      }
    initialize(currentValue, numParticipants);
    }
    
  }
  //this sets the characteristics of the rectangles
  function initialize(currentValue, numParticipants) {
    d3.select("svg").remove();
    currentValue = (currentValue / numParticipants) * 100;
    var newData = [100, currentValue]; // here are the data values; v1 = total, v2 = current value
    var width = 100;
    var height = 500;
    var svg = d3.select("#container").append("svg") // creating the svg object inside the container div
      .attr("class", "chart")
      .attr("width", width) // bar has a fixed width
      .attr("height", height); // bar has fixed height
    var x = d3.scaleLinear()
      .domain([0, 1])
      .range([0, 100]);
    var y = d3.scaleLinear()
      .domain([0, 100])
      .rangeRound([0, height]);
    svg.selectAll("rect") // this is what actually creates the bars
      .data(newData)
      .enter().append("rect")
      .attr("width", width)
      .attr("height", function(d) { return y(d); })
      .attr("rx", 5) // rounded corners
      .attr("ry", 5);
    wait();
  }
  function wait() {
    flag = false;
  }
  });
  
  /*  
  svg.selectAll("text") // adding the text labels to the bar
    .data(data)
  .enter().append("text")
    .attr("x", function(d, i) { return x(i) + (width / 2);})
    .attr("y", function(d, i) { return height - y(d) + 20;}) // y position of the text inside bar
    .attr("text-anchor", "middle") // text-align: right
    .style("fill", "black")
    .text(function(d) { return d;});
  */
  </script>
</body>
</html>